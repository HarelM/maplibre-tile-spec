
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="MapLibre Tile Specification">
      
      
      
        <link rel="canonical" href="https://www.maplibre.org/maplibre-tile-spec/specification/">
      
      
        <link rel="prev" href="../encodings/">
      
      
      
      <link rel="icon" href="https://maplibre.org/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>Specification - MapLibre Tile Specification</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/extra.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/panzoom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Specification - MapLibre Tile Specification" >
      
        <meta  property="og:description"  content="MapLibre Tile Specification" >
      
        <meta  property="og:image"  content="https://www.maplibre.org/maplibre-tile-spec/assets/images/social/specification.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://www.maplibre.org/maplibre-tile-spec/specification/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Specification - MapLibre Tile Specification" >
      
        <meta  name="twitter:description"  content="MapLibre Tile Specification" >
      
        <meta  name="twitter:image"  content="https://www.maplibre.org/maplibre-tile-spec/assets/images/social/specification.png" >
      
    
    
  <meta name="panzoom-theme" content="material">
<meta name="panzoom-data" content='{"selectors": [".mermaid", ".d2"], "initial_zoom_level": 1.0}'> </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#maplibre-tile-specification" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MapLibre Tile Specification" class="md-header__button md-logo" aria-label="MapLibre Tile Specification" data-md-component="logo">
      
  <img src="../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MapLibre Tile Specification
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Specification
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/maplibre/maplibre-tile-spec" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MapLibre Tile Specification" class="md-nav__button md-logo" aria-label="MapLibre Tile Specification" data-md-component="logo">
      
  <img src="../assets/logo.svg" alt="logo">

    </a>
    MapLibre Tile Specification
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/maplibre/maplibre-tile-spec" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../encodings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Encoding Algorithms
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Specification
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Specification
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-storage-format" class="md-nav__link">
    <span class="md-ellipsis">
      1. Storage Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Storage Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-basics" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 Basics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-file-layout" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 File Layout
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.2 File Layout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.1 Metadata
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.2.1 Metadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tileset-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Tileset Metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tile-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Tile Metadata
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.2 Type system
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.2.2 Type system">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1221-physical-types" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.2.1 Physical Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1222-logical-types" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.2.2 Logical Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nested-fields-encoding" class="md-nav__link">
    <span class="md-ellipsis">
      Nested Fields Encoding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rangemap" class="md-nav__link">
    <span class="md-ellipsis">
      RangeMap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#123-encoding-schemes" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.3 Encoding Schemes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#124-featuretable-layout" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.4 FeatureTable Layout
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.2.4 FeatureTable Layout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#id-column" class="md-nav__link">
    <span class="md-ellipsis">
      ID Column
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geometry-column" class="md-nav__link">
    <span class="md-ellipsis">
      Geometry Column
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#property-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Property Columns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-example-layouts" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 Example Layouts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.3 Example Layouts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#131-place-layer" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.1 Place layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-linestring-geometry-with-flat-properties" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.2 LineString geometry with flat properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#133-multipolygon-with-flat-properties" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.3 MultiPolygon with flat properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#134-vertex-scoped-and-feature-scoped-properties" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.4 Vertex-scoped and feature-scoped properties
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sorting" class="md-nav__link">
    <span class="md-ellipsis">
      Sorting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-encodings" class="md-nav__link">
    <span class="md-ellipsis">
      1.4 Encodings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-in-memory-format" class="md-nav__link">
    <span class="md-ellipsis">
      2. In-Memory Format
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/maplibre/maplibre-tile-spec/edit/main/mkdocs/docs/specification.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="maplibre-tile-specification">MapLibre Tile Specification</h1>
<blockquote>
<p><strong>Note:</strong> This is a live specification that evolves continuously. Features marked as <span class="experimental"></span> are under active development and may change in future versions. Stable features are those without experimental tags.</p>
</blockquote>
<h2 id="1-storage-format">1. Storage Format</h2>
<h3 id="11-basics">1.1 Basics</h3>
<p>MLT (MapLibre Tile) contains information about a specific geographic region - a tile. Each tile is a collection of <code>FeatureTables</code>, which are equivalent to Layers in the <a href="https://github.com/mapbox/vector-tile-spec">MVT specification</a>.</p>
<p>Each <code>FeatureTable</code> contains thematically grouped vector data, known as Features. Features in one FeatureTable share a common set of attribute columns (properties) and usually share the same geometry type (but not required to).</p>
<p>The visual appearance of a tile on a map is usually controlled by <a href="https://maplibre.org/maplibre-style-spec/">MapLibre Style Specification</a>, which specifies how the features in the FeatureTables are rendered.</p>
<p>Each feature must have a <code>geometry</code> column, an optional <code>id</code> column, and optional property columns. The geometry column type is based on the OGC's Simple Feature Access Model (SFA) without the support for GeometryCollection types.</p>
<p>The geometries are not restricted to one geometry type, but this is recommended for reasons of efficiency.
As in MVT, the geometry coordinates are encoded as integers in a vector tile grid coordinates.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>"column", "field", and "property" are used interchangeably in this document.</p>
</div>
<h3 id="12-file-layout">1.2 File Layout</h3>
<p>A FeatureTable in the MLT specification is based on a tabular, column-oriented layout.
It uses different lightweight compression schemes to efficiently encode the values of the columns.
A FeatureTable consists of a optional <code>id</code> column, a mandatory <code>geometry</code> column and optional property columns.
Because there is no tile header, <code>FeatureTable</code>s can be concatenated on the fly.</p>
<p>A logical column is separated into several physical <code>streams</code> (sub-columns) inspired by the ORC file format which are stored next to each other. A stream is a sequence of values of a known length in a continuous chunk of memory, all having the same type. A stream has some additional metadata such as the size of the stream and the encoding type.
For example, a nullable string property column can have a <code>present stream</code>, which indicates the presence of a value,
a <code>length</code> stream, which describes the number of characters of every string, and a <code>data stream</code>, with the actual
UTF-8 encoded string values.</p>
<p>MLT distinguishes between the following type of streams:</p>
<ul>
<li><strong>present</strong>:
  Is used for a efficient encoding of sparse columns since it indicates the presence of a value base on a bit flag.
  This stream can be omitted if the column is not declared as nullable in the <code>FieldMetadata</code>.</li>
<li><strong>data</strong>:
  Stores the actual data of a column such as <code>boolean</code>, <code>int</code>, <code>float</code>, or <code>string</code> values of the feature properties.
  Dictionary-encoded values, string values, or the coordinate values of a geometry column are stored in this type of stream.
  In addition to the optional present stream, this is the only used stream type for fixed-sized data types such as <code>boolean</code>, <code>int</code>, and <code>float</code>.</li>
<li><strong>length</strong>:
  Specifies the number of elements for variable-sized data types such as strings or list.</li>
<li><strong>offset</strong>:
  Stores the offsets into a data stream when dictionary encoding is used such as for strings or vertices.</li>
</ul>
<p>This physical streams are further divided into logical streams that add additional semantics of how to interpret the data:</p>
<p><img alt="" src="../assets/spec/LogicalStreams.png" /></p>
<h4 id="121-metadata">1.2.1 Metadata</h4>
<h5 id="tileset-metadata">Tileset Metadata</h5>
<p>Global metadata for the tileset is stored separately, in <a href="../assets/spec/mlt_tileset_metadata.json">JSON format</a>.</p>
<p>The tileset metadata defines information for the full tileset is the equivalent to the TileJSON spec, which is commonly used in combination with MVT.</p>
<p>By specifying the information once per tileset, the definition of redundant (shared) metadata per tile will be avoided,
which can take some relevant space of the overall size on small tiles.</p>
<h5 id="tile-metadata">Tile Metadata</h5>
<p>Each <code>FeatureTable</code> is preceded by a <code>FeatureTableMetadata</code> describing it.</p>
<p>A tile consists of any number of:</p>
<ul>
<li>The size of the <code>FeatureTableMetadata</code> to follow, varint-encoded</li>
<li>The size of the <code>FeatureTable</code> to follow, varint-encoded</li>
<li>One <code>FeatureTableMetadata</code></li>
<li>One <code>FeatureTable</code></li>
</ul>
<p>The <code>FeatureTableMetadata</code> is described in detail below.</p>
<p>Each <code>FeatureTableMetadata</code>/<code>FeatureTable</code> pair may contain one or more layers.  This allows the tile to be built by simple concatenation of separate results.</p>
<p>Within a <code>FeatureTable</code>, additional metadata describes the structure of each part:</p>
<ul>
<li><strong>FieldMetadata</strong>: contains information about the number of streams the field is divided and the vector type for efficient decoding into the in-memory format. Every Field (column) section is preceded by a <code>FieldMetadata</code> section.</li>
<li><strong>StreamMetdata</strong>: contains information about the Stream such as the used encoding schemes
  and the number of values. Every Stream section is preceded by a <code>StreamMetadata</code> section.</li>
</ul>
<p>Since for every <code>Field</code>, a <code>FieldMetadata</code> section has to be present, even for fields which are not included in one
specific tile, no <code>id</code> is needed.
The absence of an entire field in a tile can be identified by a zero value for the number of streams.
All integers in the metadata sections are <code>Varint</code>-encoded if u32 is used or bit-packed in case of an u8 data type.</p>
<div class="panzoom-box" data-key="alt" id="panzoom0" oncontextmenu="return false;">
    
    <nav class="panzoom-nav">
    <button class="panzoom-info panzoom-button">
    <svg class="panzoom-icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm169.8-90.7c7.9-22.3 29.1-37.3 52.8-37.3l58.3 0c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24l0-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1l-58.3 0c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"></path>
    </svg>
</button><button class="panzoom-reset panzoom-button">
    <svg class="panzoom-icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M125.7 160l50.3 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L48 224c-17.7 0-32-14.3-32-32L16 64c0-17.7 14.3-32 32-32s32 14.3 32 32l0 51.2L97.6 97.6c87.5-87.5 229.3-87.5 316.8 0s87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3s-163.8-62.5-226.3 0L125.7 160z"></path>
    </svg>
</button>
    </nav>
    <pre class="mermaid"><code>---
title: FeatureTableSchema
config:
  class:
    hideEmptyMembersBox: true
---
classDiagram
    note for LogicalScalarType "[EXPERIMENTAL]"
    note for ComplexColumn "[EXPERIMENTAL]"
    note for ComplexField "[EXPERIMENTAL]"
    note for ComplexType "[EXPERIMENTAL]"
    note for LogicalComplexType "[EXPERIMENTAL]"
    note for Field "[EXPERIMENTAL]"
    note for ScalarField "[EXPERIMENTAL]"

    %% ---------------- Tile ----------------
    class Tile {
      +LayerGroup[] groups
    }

    %% ---------------- LayerGroup ----------------
    class LayerGroup {
      +VarInt metadataSize
      +TileMetadata metadata
      +u8[] tileData
    }

    %% ---------------- TileMetadata ----------------
    class TileMetadata {
      +FeatureTable[] featureTables
    }

    %% ---------------- FeatureTable ----------------
    class FeatureTable {
      +String name
      +VarInt columnCount
      +Column[] columns
    }

    %% ---------------- Column ----------------
    class Column {
      +ColumnOptions options %% VarInt
      +String name
      +ScalarColumn scalarType %% oneof i.e., scalarType XOR complexType
      +ComplexColumn complexType
    }

    %% ---------------- ScalarColumn ----------------
    class ScalarColumn {
      +ScalarColumnOptions options %% VarInt
      +ScalarType physicalType %% oneof i.e., physicalType XOR logicalType
      +LogicalScalarType logicalType
    }

    %% ---------------- ComplexColumn [EXPERIMENTAL] ----------------
    class ComplexColumn {
      +ComplexType physicalType %% oneof i.e., physicalType XOR logicalType
      +LogicalComplexType logicalType
      +VarInt childCount %% Present only if CHILD_TYPES is set in columnOptions
      +Field[] children
    }

    %% ---------------- Field ----------------
    class Field {
      +FieldOptions options %% VarInt
      +String name
      +ScalarField scalarField %% oneof i.e., scalarField XOR complexField
      +ComplexField complexField
    }

    %% ---------------- ScalarField ----------------
    class ScalarField {
      +ScalarType physicalType %% oneof i.e., physicalType XOR logicalType
      +LogicalScalarType logicalType
    }

    %% ---------------- ComplexField [EXPERIMENTAL] ----------------
    class ComplexField {
      +ComplexType physicalType %% oneof i.e., physicalType XOR logicalType
      +LogicalComplexType logicalType
      +VarInt childCount %% Present only if CHILD_TYPES is set in columnOptions
      +Field[] children
    }

    %% ---------------- String ------------------
    class String {
      +VarInt length
      +u8 bytes[length] %% encoding is always UTF-8
    }

    %% ---------------- Enumerations ----------------
    class ScalarType {
      &lt;&lt;enumeration&gt;&gt;
      BOOLEAN = 0
      INT_8 = 1
      UINT_8 = 2
      INT_32 = 3
      UINT_32 = 4
      INT_64 = 5
      UINT_64 = 6
      FLOAT = 7
      DOUBLE = 8
      STRING = 9
      INT_128 = 10
      UINT_128 = 11
    }

    class LogicalScalarType {
      &lt;&lt;enumeration&gt;&gt;
      TIMESTAMP = 0
      DATE = 1
      JSON = 2
    }

    class ComplexType {
      &lt;&lt;enumeration&gt;&gt;
      VEC_2 = 0
      VEC_3 = 1
      GEOMETRY = 2
      GEOMETRY_Z = 3
      LIST = 4
      MAP = 5
      STRUCT = 6
    }

    class LogicalComplexType {
      &lt;&lt;enumeration&gt;&gt;
      BINARY = 0
      RANGE_MAP = 1
    }

    class FieldOptions {
      &lt;&lt;enumeration&gt;&gt;
      NULLABLE = 1, %% Property is nullable
      COMPLEX_TYPE = 2, %% A complexType follows if set, else a scalarType [EXPERIMENTAL]
      LOGICAL_TYPE = 4, %% A logical type follows if set, else a physical type [EXPERIMENTAL]
      CHILD_TYPES = 8, %% 1: Child types are present [EXPERIMENTAL]
    }

    class ColumnOptions {
      &lt;&lt;enumeration&gt;&gt;
      VERTEX_SCOPE = 16, %% Property is vertex-scope if set, else feature-scope
    }

    %% ---------------- Associations ----------------
    FieldOptions &lt;|-- ColumnOptions
    Tile --&gt; LayerGroup : groups
    LayerGroup --&gt; TileMetadata : metadata
    TileMetadata --&gt; FeatureTable : featureTables
    FeatureTable --&gt; Column : columns
    Column --&gt; ScalarColumn : scalarType
    Column --&gt; ComplexColumn : complexType
    ComplexColumn --&gt; Field : children
    ComplexField --&gt; Field : children
    Field --&gt; ComplexField : complexField
    Field --&gt; ScalarField : scalarField</code></pre> 
    <div class="panzoom-info-box panzoom-info-box-bottom panzoom-hidden">
Hold "Alt" / "Option" to enable pan &amp; zoom
</div>
</div>
<h4 id="122-type-system">1.2.2 Type system</h4>
<p>The types system of MLT is divided into physical and logical types.
The physical types define the layout of the data in the storage format, while the logical types give additional semantics to the physical types.
Based on this separation, the encoding and decoding of the data can be simplified.
This reduces the complexity for implementing encoder and decoder as well allow the encodings to be reused.</p>
<h5 id="1221-physical-types">1.2.2.1 Physical Types</h5>
<p>The physical types define the layout of the data in the storage format.
Both scalar and complex types can be divided into fixed-size binaries and variable-size binaries.
Variable-size binaries have an additional length stream which specifies the size of each element.
All fixed-size binaries have the same bit (boolean) or byte width and therefore no additional length stream is used.</p>
<p><strong>Scalar Types</strong></p>
<p>Each scalar type has a specific encoding scheme which can be applied to the data stream.</p>
<table>
<thead>
<tr>
<th>DataType</th>
<th>Logical Types</th>
<th>Description</th>
<th>Layout</th>
</tr>
</thead>
<tbody>
<tr>
<td>Boolean</td>
<td></td>
<td></td>
<td>Fixed-Size</td>
</tr>
<tr>
<td>Int8, UInt8, Int32, UInt32, Int64 , UInt64</td>
<td>Date (int32), Timestamp (int64)</td>
<td></td>
<td>Fixed-Size</td>
</tr>
<tr>
<td>Float, Double</td>
<td></td>
<td></td>
<td>Fixed-Size</td>
</tr>
<tr>
<td>String</td>
<td>JSON</td>
<td>UTF-8 encoded sequence of characters</td>
<td>Variable-Size</td>
</tr>
</tbody>
</table>
<p><b>Complex Types <span class="experimental"/></b></p>
<p>Complex types are composed of scalar types.</p>
<table>
<thead>
<tr>
<th>DataType</th>
<th>Logical Types</th>
<th>Description</th>
<th>Layout</th>
</tr>
</thead>
<tbody>
<tr>
<td>List</td>
<td>Binary (List<UInt8>)</td>
<td></td>
<td>Variable-Size</td>
</tr>
<tr>
<td>Map</td>
<td>Map<vec2d, T></td>
<td>additional key stream -&gt; length, key, data streams</td>
<td>Variable-Size</td>
</tr>
<tr>
<td>Struct</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Vec2<T>, Vec3<T></td>
<td>Geometry, GeometryZ</td>
<td></td>
<td>Fixed-Size</td>
</tr>
</tbody>
</table>
<h5 id="1222-logical-types">1.2.2.2 Logical Types <span class="experimental"/></h5>
<p>Add additional semantics on top of the physical types.
This had the advantage that encodings can be reused and implementation of encoders and decoders can be simplified.</p>
<table>
<thead>
<tr>
<th>Logical Type</th>
<th>Physical Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Date</td>
<td>Int32</td>
<td>number of days since Unix epoch</td>
</tr>
<tr>
<td>Timestamp</td>
<td>Int64</td>
<td>number of milliseconds since Unix epoch</td>
</tr>
<tr>
<td>RangeMap</td>
<td>Map<vec2\<Double>, T></td>
<td>for storing linear referencing information</td>
</tr>
<tr>
<td>Binary</td>
<td>List<UInt8></td>
<td></td>
</tr>
<tr>
<td>JSON</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>Geometry</td>
<td>vec2<Int32></td>
<td></td>
</tr>
<tr>
<td>GeometryZ</td>
<td>vec3<Int32></td>
<td></td>
</tr>
</tbody>
</table>
<h5 id="nested-fields-encoding">Nested Fields Encoding</h5>
<p>For nested properties such as structs and lists, a <a href="https://arxiv.org/pdf/2304.05028.pdf">present/length</a> pair encoding
is selected over the widely used Dremel encoding, since it is simpler to implement and faster to decode into the in-memory format.
Every nullable field, has an additional <code>present</code> stream.
Every field that is a collection type, such as a list, has an additional <code>length</code> stream that specifies the length of the field.
Like in ORC, the nested fields are flattened based on a pre-order traversal.
In addition, nested fields can use a shared dictionary encoding, to share a common dictionary between the fields.
This can be applied, for example, on localized values of the name:* columns of an OSM dataset that can be identical across fields.
If a shared dictionary encoding is used for nested fields, all fields that use the shared dictionary
must be grouped sequentially in the file and prefixed with the dictionary.</p>
<h5 id="rangemap">RangeMap <span class="experimental"/></h5>
<p>RangeMaps are an efficient way to encode linear referencing information, as used for example in <a href="https://docs.overturemaps.org/overview/feature-model/scoping-rules#geometric-scoping-linear-referencing">Overture Maps</a>.
RangesSets store the range values and data values in two separate streams.
The min and max values for the ranges are stored as interleaved double values in a separate range stream.</p>
<h4 id="123-encoding-schemes">1.2.3 Encoding Schemes</h4>
<p>MLT uses different lightweight compression schemes for the space efficient storage and fast decoding of the data types.
To further reduce the size of a column the encodings can be recursively cascaded (hybrid encodings) up to a certain level.
For example the resulting integer columns of a dictionary encoding can be further compressed based on one of the Integer encoding schemes.
The following encoding pool for specific data types was selected based on the analytics on the efficiency
in terms of the compression ratio and decoding speed on test datasets such as the OpenMapTiles schema and Bing Maps based tilesets.</p>
<table>
<thead>
<tr>
<th>DataType</th>
<th>Logical  Level Technique</th>
<th>Physical Level Technique</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Boolean</td>
<td><a href="https://orc.apache.org/specification/ORCv1/#boolean-run-length-encoding">Boolean RLE</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Integer</td>
<td>Plain, RLE, Delta, Delta-RLE</td>
<td><a href="https://arxiv.org/pdf/1209.2137.pdf">SIMD-FastPFOR</a>, <a href="https://protobuf.dev/programming-guides/encoding/#varints">Varint</a></td>
<td></td>
</tr>
<tr>
<td>Float</td>
<td>Plain, RLE, Dictionary, <a href="https://dl.acm.org/doi/pdf/10.1145/3626717">ALP</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td>String</td>
<td>Plain, Dictionary, <a href="https://www.vldb.org/pvldb/vol13/p2649-boncz.pdf">FSST</a> Dictionary</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Geometry</td>
<td>Plain, Dictionary, Morton-Dictionary</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>ALP</code>, <code>FSST</code>, and <code>FastPFOR</code> encodings are <span class="experimental"></span>.</p>
</div>
<p>Since SIMD-FastPFOR generally produces smaller data streams and is faster to decode, it should be preferred over Varint encoding.
Varint encoding is mainly added to the encoding pool for compatibility reasons and it's simpler implementation compared to SIMD-FastPFOR.
Varint encoding also can be more efficient when used in combination with heavyweight compression schemes like GZip.</p>
<p>To find the best coding schemes for a specific data type from the coding pool, using a brute force approach by testing all available schemes
with respect to the resulting column size would be too costly. The recommended approach improves the selection time by using
the selection strategy described in the <a href="https://www.cs.cit.tum.de/fileadmin/w00cfj/dis/papers/btrblocks.pdf">BTRBlocks</a> paper:</p>
<ul>
<li>First, calculation of data metrics to early exclude encodings. For example if the average run length is less than 2,
  RLE encoding is not a candidate for the encodings pool</li>
<li>Second, use a sampling-based algorithm for choosing the best compression scheme out of the pool by taking randomly parts
  of the data with a total size of 1% of the full data and apply the encoding schemes selected in step 1. Apply the encoding scheme
  on the data which produces the smallest output</li>
</ul>
<h4 id="124-featuretable-layout">1.2.4 FeatureTable Layout</h4>
<h5 id="id-column">ID Column</h5>
<p>No <code>id</code> column is mandatory.  If an identifier column is included, it should be u64 or a narrower integer type for compatibility with MVT.
Narrow the column to u32, if possible, to enable the use of FastPfor128 encoding.</p>
<h5 id="geometry-column">Geometry Column</h5>
<p>The main idea is to use a structure of arrays (data-oriented design) layout for the geometries.
The <code>x</code>, <code>y</code>, and optional <code>z</code> coordinates are stored interleaved in a <code>VertexBuffer</code> so that they can be efficiently processed
on the CPU or even directly copied to GPU buffers. If the <code>z</code> coordinate is not relevant for rendering, it can be stored separately as
an m-coordinate (see vertex-scoped properties).</p>
<p>The information about the geometry of the features is separated in different streams and is partly inspired
by the <a href="https://github.com/geoarrow/geoarrow">geoarrow</a> specification.
Using separate streams for describing the geometry of a feature enables a better optimization of the compression
and faster processing. In addition, pre-tessellated polygon meshes can be stored directly in the file to avoid the time-consuming triangulation step.</p>
<p>A geometry column can consist of the following streams:</p>
<table>
<thead>
<tr>
<th>Stream name</th>
<th style="text-align: center;">Data type</th>
<th style="text-align: center;">encoding</th>
<th style="text-align: center;">mandatory</th>
</tr>
</thead>
<tbody>
<tr>
<td>GeometryType</td>
<td style="text-align: center;">Byte</td>
<td style="text-align: center;">see availabe integer encodings</td>
<td style="text-align: center;">&#10003;</td>
</tr>
<tr>
<td>NumGeometries</td>
<td style="text-align: center;">UInt32</td>
<td style="text-align: center;">see availabe integer encodings</td>
<td style="text-align: center;">&#10007;</td>
</tr>
<tr>
<td>NumParts</td>
<td style="text-align: center;">UInt32</td>
<td style="text-align: center;">see availabe integer encodings</td>
<td style="text-align: center;">&#10007;</td>
</tr>
<tr>
<td>NumRings</td>
<td style="text-align: center;">UInt32</td>
<td style="text-align: center;">see availabe integer encodings</td>
<td style="text-align: center;">&#10007;</td>
</tr>
<tr>
<td>NumTriangles</td>
<td style="text-align: center;">UInt32</td>
<td style="text-align: center;">see availabe integer encodings</td>
<td style="text-align: center;">&#10007;</td>
</tr>
<tr>
<td>IndexBuffer</td>
<td style="text-align: center;">UInt32</td>
<td style="text-align: center;">see availabe integer encodings</td>
<td style="text-align: center;">&#10007;</td>
</tr>
<tr>
<td>VertexOffsets</td>
<td style="text-align: center;">UInt32</td>
<td style="text-align: center;">see availabe integer encodings</td>
<td style="text-align: center;">&#10007;</td>
</tr>
<tr>
<td>VertexBuffer</td>
<td style="text-align: center;">Int32 or Vertex[]</td>
<td style="text-align: center;">Plain, Dictionary or Morton Dictionary</td>
<td style="text-align: center;">&#10003;</td>
</tr>
</tbody>
</table>
<p>Depending on the type of the geometry, the geometry column can have the following streams in addition to the <code>GeometryType</code> stream:</p>
<ul>
<li>Point: VertexBuffer</li>
<li>LineString: NumParts, VertexBuffer</li>
<li>Polygon: NumParts (Polygon), NumRings (LinearRing), VertexBuffer</li>
<li>MultiPoint: NumGeometries, VertexBuffer</li>
<li>MultiLineString: NumGeometries, NumParts (LineString), VertexBuffer</li>
<li>MultiPolygon: NumGeometries, NumParts (Polygon), NumRings (LinearRing), VertexBuffer</li>
</ul>
<p>In addition, the geometry column can consist of an additional <code>VertexOffsets</code> stream when a Dictionary or Morton-Dictionary
encoding is applied. If the geometries (mainly polygons) are stored in a tessellated/triangulated form for direct copying to a GPU Buffer,
an additional <code>NumTriangles</code> and <code>IndexBuffer</code> must be provided.</p>
<h5 id="property-columns">Property Columns</h5>
<p>The properties of a feature are divided into <code>feature-scoped</code> and <code>vertex-scoped</code> properties.
The values of feature-scoped properties are related to a specific Feature, which means there is one value in
a property column per feature.</p>
<p>The values of a vertex-scoped properties are related to each vertex, which means there is one value in a property column
per vertex in the VertexBuffer. This allows to model what is known as M-coordinates in GIS applications.
Vertex-scoped properties have to be grouped together and are placed before the feature-scoped properties in the FeatureTable.
The scope of a property column is specified in the tileset metadata document based on the <code>ColumnScope</code> enum.</p>
<p>A property column can have one of the above listed <a href="#122-type-system">data types</a>.</p>
<h3 id="13-example-layouts">1.3 Example Layouts</h3>
<p>In the following, examples for the layout of a <code>FeatureTable</code> in storage are illustrated.
The following colors are used to highlight different kind of data:</p>
<ul>
<li>blue boxes: columns that have only logical character and are not persisted.
  Based on the TileSet metadata the fields can be reconstructed from the streams.</li>
<li>white boxes: metadata which describe the structure of the data. The metadata is divided into
  FeatureTable, Stream (SM) and Feature (FM) metadata</li>
<li>yellow boxes: streams which contains the actual data</li>
</ul>
<h4 id="131-place-layer">1.3.1 Place layer</h4>
<p>Given a place <a href="../assets/spec/place_feature.json">layer</a> with the following structure modeled as Json schema:
<img alt="" src="../assets/spec/place_feature.png" /></p>
<p>For the given schema the place layer can have the following layout in a MLT tile
when a dictionary for the <code>geometry</code> and <code>name</code> column is used.
<img alt="img_2.png" src="../assets/spec/img_2.png" /></p>
<h4 id="132-linestring-geometry-with-flat-properties">1.3.2 LineString geometry with flat properties</h4>
<p>Encoding of a <code>FeatureTable</code> with an <code>id</code> field, a <code>LineString</code> geometry field and the flat feature scoped properties class and subclass:
<img alt="img_4.png" src="../assets/spec/img_4.png" /></p>
<h4 id="133-multipolygon-with-flat-properties">1.3.3 MultiPolygon with flat properties</h4>
<p>Encoding of a <code>FeatureTable</code> with a <code>id</code> field, <code>MultiPolygon</code> geometry field and flat feature scoped property fields.
Because vertex dictionary encoding is used a <code>VertexOffsets</code> stream is present:
<img alt="img_5.png" src="../assets/spec/img_5.png" /></p>
<h4 id="134-vertex-scoped-and-feature-scoped-properties">1.3.4 Vertex-scoped and feature-scoped properties</h4>
<p>Example layout for encoding of vertex-scoped and feature scoped properties.
All vertex-scoped properties have to be grouped together and placed before the feature-scoped properties
in the file. Since the <code>id</code> colum in this example is not <code>nullable</code>, the present stream can be omitted.
<img alt="img_7.png" src="../assets/spec/img_7.png" /></p>
<h3 id="sorting">Sorting</h3>
<p>Choosing the right column for sorting the features can have significant impact on the size
of the <code>FeatureTable</code>. To take full advantage of the columnar layout, sorting is crucial.
To test every layer for every possible sorting order of every column is too costly.</p>
<h3 id="14-encodings">1.4 Encodings</h3>
<p>The details of encodings are specified in <a href="../encodings/">a separate document</a>.</p>
<h2 id="2-in-memory-format">2. In-Memory Format</h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The in-memory format will be explained in more detail; the following is only a rough overview:</p>
</div>
<p>The record-oriented, in-memory model (array of structures approach) used by the libraries that process
the Mapbox Vector Tiles leads to a considerable overhead, such as the creation of a large number of small objects (per-object memory allocation),
that place an additional load on the garbage collector in the browser.</p>
<p>By using a columnar memory layout (data-oriented design), for the MLT in-memory format, we can overcome these issues and
additionally take advantage of an improved cache utilization for subsequent access and fast SIMD instructions for the processing of the data.
The MLT in-memory format incorporates and extends the ideas from the analytical in-memory formats Apache Arrow, Velox, and the DuckDB execution
format and is tailored for the visualization use case. To be future-proof it is important that the file can be parallel processed on the GPU for the
usage within a GPU compute shader.</p>
<p>The main design goals of the MLT in-memory format are:</p>
<ul>
<li>Define a platform-agnostic representation to avoid the expensive materialization costs in particular for strings</li>
<li>Enable advanced CPU throughput by optimizing the memory layout for cache locality and SIMD instructions</li>
<li>Allow random (mainly constant time) access to all data, so it can also be parallel processed on the GPU (compute shader)</li>
<li>Provide compressed data structure which can be directly processed without decoding</li>
<li>Provide the geometries of a tile in a representation that can be (directly) loaded into GPU buffers with little or no additional processing</li>
</ul>
<p>The data are stored in continuous memory buffers, referred to as vectors, with additional metadata and an optional nullability bitmap
for representing null values. The storage format contains a <code>VectorType</code> field in the metadata that tells the decoder
which vector type to use for a specific filed. In order to enable random access to variable-sized data types such as strings or lists,
an auxiliary buffer containing offset values will be utilized.</p>
<p>The MLT in-memory format supports the following vectors:</p>
<ul>
<li><a href="https://duckdb.org/internals/vector.html#flat-vectors">Flat Vectors</a></li>
<li><a href="https://duckdb.org/internals/vector.html#constant-vectors">Constant Vectors</a></li>
<li><a href="https://duckdb.org/internals/vector.html#sequence-vectors">Sequence Vectors</a></li>
<li><a href="https://duckdb.org/internals/vector.html#dictionary-vectors">Dictionary Vectors</a></li>
<li>FSST Dictionary Vectors <span class="experimental"/></li>
<li>Shared Dictionary Vectors <span class="experimental"/></li>
<li><a href="https://arrow.apache.org/docs/format/Columnar.html#run-end-encoded-layout">Run-End Encoded (REE) Vectors</a></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Further evaluation is needed to determine if the <a href="https://arxiv.org/pdf/2306.15374.pdf">latest research findings</a>
can be used to enable random access on delta encoded values as well</p>
</div>
<p>In case a compressed vector can be used, this has the additional advantage that the conversion from the storage
into in-memory format is basically a zero-copy operation.</p>
<p>Following Apache Arrow's approach based on the <a href="https://www.intel.com/content/www/us/en/developer/topic-technology/data-center/overview.html">Intel performance guide</a>,
we recommend that decoders should allocate memory on aligned addresses with a multiple of 64-bytes (if possible).</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
      
    
    
    
      
      
    
    <a href="https://mastodon.social/@maplibre" target="_blank" rel="noopener me" title="mastodon.social" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M433 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.6-28.4-290.5 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.6-.9-9.3-.9-13.9 85.6 20.9 158.7 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zm-75.1 125.2h-46.6V190.1c0-49.7-64-51.6-64 6.9v62.5H201V197c0-58.5-64-56.6-64-6.9v114.2H90.3c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/maplibre" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/maplibre" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://osmus.slack.com/archives/C01G3D28DAB" target="_blank" rel="noopener" title="osmus.slack.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M94.1 315.1c0 25.9-21.2 47.1-47.1 47.1S0 341 0 315.1 21.2 268 47.1 268h47.1v47.1zm23.7 0c0-25.9 21.2-47.1 47.1-47.1s47.1 21.2 47.1 47.1v117.8c0 25.9-21.2 47.1-47.1 47.1s-47.1-21.2-47.1-47.1zm47.1-189c-25.9 0-47.1-21.2-47.1-47.1s21.2-47 47.1-47S212 53.2 212 79.1v47.1h-47.1zm0 23.7c25.9 0 47.1 21.2 47.1 47.1S190.8 244 164.9 244H47.1C21.2 244 0 222.8 0 196.9s21.2-47.1 47.1-47.1zm189 47.1c0-25.9 21.2-47.1 47.1-47.1s47 21.2 47 47.1-21.2 47.1-47.1 47.1h-47.1v-47.1zm-23.7 0c0 25.9-21.2 47.1-47.1 47.1S236 222.8 236 196.9V79.1c0-25.9 21.2-47.1 47.1-47.1s47.1 21.2 47.1 47.1zm-47.1 189c25.9 0 47.1 21.2 47.1 47.1s-21.2 47-47.1 47-47.1-21.2-47.1-47.1v-47.1h47.1zm0-23.7c-25.9 0-47.1-21.2-47.1-47.1s21.2-47.1 47.1-47.1h117.8c25.9 0 47.1 21.2 47.1 47.1s-21.2 47.1-47.1 47.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/maplibre" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "search.suggest", "navigation.instant", "navigation.sections", "content.action.edit", "toc.integrate"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../assets/javascripts/panzoom.min.js"></script>
      
        <script src="../assets/javascripts/zoompan.js"></script>
      
    
  </body>
</html>